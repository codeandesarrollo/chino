<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Terapia Â· Nivel 1 (Auto)</title>
<style>
  :root{
    --bg1:#0f172a; --bg2:#1e293b; --text:#e5e7eb; --muted:#94a3b8;
    --card:#0b1220cc; --b:#1a2650; --acc:#60a5fa; --ok:#22c55e;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,Segoe UI,Roboto,Inter,sans-serif; color:var(--text);
    background: radial-gradient(1200px 800px at 20% 10%, #0b1020 0, transparent 60%),
                radial-gradient(900px 600px at 80% 90%, #0a182f 0, transparent 60%),
                linear-gradient(135deg,var(--bg1),var(--bg2));
    display:flex; align-items:center; justify-content:center; padding:18px;
  }
  .card{
    width:min(960px,96vw); background:var(--card); border:1px solid var(--b); border-radius:18px;
    box-shadow:0 12px 40px rgba(0,0,0,.35); overflow:hidden;
  }
  header{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    padding:14px 16px; border-bottom:1px solid var(--b); background:#0e1930aa;
  }
  .title{display:flex; align-items:center; gap:10px}
  .logo{width:32px; height:32px; border-radius:12px; background:conic-gradient(from 0deg,#60a5fa,#22c55e,#60a5fa)}
  h1{font-size:16px; margin:0; letter-spacing:.3px}
  .hud{display:flex; gap:8px; flex-wrap:wrap}
  .tag{border:1px solid #22345f; background:#0e1830; color:#cbd5e1; padding:6px 10px; border-radius:999px; font-weight:600; font-size:13px}
  main{display:grid; grid-template-columns:1fr 300px; gap:16px; padding:16px}
  @media (max-width:900px){ main{grid-template-columns:1fr} .side{order:-1} }
  .stage{
    min-height:56vh; border:1px dashed #23345d; border-radius:14px; background:#0c1528;
    display:flex; align-items:center; justify-content:center; padding:16px; text-align:center; position:relative; overflow:hidden;
  }
  .big{
    width:min(300px,70vw); height:min(300px,70vw); border-radius:999px; border:2px solid #22408c;
    background:radial-gradient(circle at 30% 30%, #60a5fa33 0 40%, transparent 41%), linear-gradient(180deg,#1d4ed8,#0b74dd);
    box-shadow:0 14px 34px #0b5bd744, inset 0 0 30px #ffffff22;
    display:flex; align-items:center; justify-content:center; color:#fff; font-size:26px; font-weight:900; user-select:none; cursor:pointer;
    transition:transform .08s ease, filter .12s linear;
  }
  .big:active{ transform: scale(.98); }
  .side{border:1px solid #23345d; border-radius:14px; background:#0c1528; padding:14px; display:flex; flex-direction:column; gap:12px}
  .bar{height:12px; border:1px solid #23345d; border-radius:999px; background:#0d172c; overflow:hidden}
  .bar i{display:block; height:100%; width:0%; background:linear-gradient(90deg,#22c55e,#60a5fa)}
  .muted{color:var(--muted); font-size:14px}
  .overlay{
    position:absolute; inset:0; display:none; align-items:center; justify-content:center; backdrop-filter: blur(6px);
    background:#071024cc; padding:20px; text-align:center;
  }
  .overlay.show{display:flex}
  .panel{background:#0c1528; border:1px solid #23345d; border-radius:16px; padding:22px; max-width:520px}
  .btn{padding:12px 16px; border-radius:14px; border:1px solid #1f2b46; background:#12203b; color:#e2e8f0; cursor:pointer; font-weight:700}
  .btn.success{background:linear-gradient(180deg,#0f766e,#10b981); border-color:#10b981}
</style>
</head>
<body>
  <div class="card" role="application" aria-label="Terapia dedos Â· Nivel 1">
    <header>
      <div class="title">
        <div class="logo" aria-hidden="true"></div>
        <h1>Nivel 1 Â· Toques grandes (auto)</h1>
      </div>
      <div class="hud">
        <span class="tag" id="hudGoal">Meta: 6 toques</span>
        <span class="tag" id="hudCount">Progreso: 0</span>
        <span class="tag" id="hudState">Estado: Preparandoâ€¦</span>
      </div>
    </header>

    <main>
      <section class="stage" id="stage" aria-live="polite" aria-atomic="true">
        <!-- El botÃ³n aparece aquÃ­ automÃ¡ticamente -->
      </section>

      <aside class="side">
        <div>
          <h3 style="margin:0 0 6px">Instrucciones</h3>
          <p class="muted">Toca el botÃ³n grande hasta llegar a 6. TambiÃ©n sirven <b>Espacio</b> o <b>Enter</b>.</p>
        </div>
        <div>
          <h3 style="margin:0 0 6px">Progreso</h3>
          <div class="bar"><i id="bar"></i></div>
        </div>
        <div>
          <h3 style="margin:0 0 6px">Opciones</h3>
          <label class="muted" style="display:flex; gap:8px; align-items:center">
            <input type="checkbox" id="optSound" checked> Sonidos
          </label>
          <label class="muted" style="display:flex; gap:8px; align-items:center">
            <input type="checkbox" id="optVibe" checked> VibraciÃ³n
          </label>
          <button class="btn" id="btnReiniciar" style="margin-top:6px">Reiniciar nivel</button>
        </div>
      </aside>
    </main>

    <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-labelledby="ovTitle">
      <div class="panel">
        <h2 id="ovTitle">Â¡Nivel completado! ðŸŽ‰</h2>
        <p class="muted">Excelente trabajo. Puedes repetirlo para practicar.</p>
        <div style="display:flex; justify-content:center; gap:8px; margin-top:10px">
          <button class="btn success" id="btnRepetir">Repetir</button>
        </div>
      </div>
    </div>

    <span id="ariaLive" style="position:absolute; left:-9999px" aria-live="assertive"></span>
  </div>

<script>
(function(){
  // ConfiguraciÃ³n nivel 1
  const GOAL = 6;
  const state = { inPlay:false, count:0, soundOn:true, vibeOn:true };

  // Elementos
  const stage = document.getElementById('stage');
  const hudCount = document.getElementById('hudCount');
  const hudState = document.getElementById('hudState');
  const bar = document.getElementById('bar');
  const ov = document.getElementById('overlay');
  const btnRepetir = document.getElementById('btnRepetir');
  const btnReiniciar = document.getElementById('btnReiniciar');
  const optSound = document.getElementById('optSound');
  const optVibe = document.getElementById('optVibe');

  // Utilidades
  function progress(){
    const pct = Math.min(100, (state.count/GOAL)*100);
    bar.style.width = pct + '%';
    hudCount.textContent = 'Progreso: ' + state.count + ' / ' + GOAL;
  }
  function vibe(ms=40){ if(state.vibeOn && 'vibrate' in navigator) navigator.vibrate(ms); }
  function beep(freq=520, dur=70, type='square'){
    if(!state.soundOn) return;
    const ctx = beep.ctx || (beep.ctx = new (window.AudioContext||window.webkitAudioContext)());
    const o = ctx.createOscillator(); const g = ctx.createGain();
    o.type = type; o.frequency.value = freq; g.gain.value = 0.04;
    o.connect(g); g.connect(ctx.destination); o.start(); setTimeout(()=>o.stop(), dur);
  }
  function clearStage(){ stage.innerHTML=''; }

  // Nivel 1: TAP grande fijo
  function startLevel(){
    clearStage();
    state.inPlay = true;
    state.count = 0;
    progress();
    hudState.textContent = 'Â¡En juego! Toca el botÃ³n.';

    const btn = document.createElement('button');
    btn.className = 'big';
    btn.innerHTML = 'TOCAR';
    btn.setAttribute('aria-label','BotÃ³n grande para tocar');
    stage.appendChild(btn);

    function tapped(){
      if(!state.inPlay) return;
      state.count++;
      progress();
      vibe(30); beep(520,60,'square');
      // brillo sutil de feedback
      btn.style.filter = 'brightness(1.06)';
      setTimeout(()=> btn.style.filter='brightness(1)', 80);
      if(state.count >= GOAL){
        state.inPlay = false;
        vibe(70); beep(660,120,'triangle'); setTimeout(()=>beep(880,120,'triangle'),120);
        hudState.textContent = 'Completado';
        ov.classList.add('show');
      }
    }

    // Click/touch
    btn.addEventListener('click', tapped);

    // Teclado: Espacio / Enter
    const k = (ev)=>{
      if(ev.code==='Space' || ev.code==='Enter'){
        ev.preventDefault(); tapped();
      }
    };
    window.addEventListener('keydown', k);
    // Limpieza cuando se repita el nivel
    btn._cleanup = ()=> window.removeEventListener('keydown', k);
    stage._cleanup = btn._cleanup;
  }

  function resetLevel(){
    if(stage._cleanup) try{ stage._cleanup(); }catch(e){}
    ov.classList.remove('show');
    startLevel();
  }

  // Eventos UI
  btnRepetir.addEventListener('click', resetLevel);
  btnReiniciar.addEventListener('click', resetLevel);
  optSound.addEventListener('change', ()=> state.soundOn = optSound.checked);
  optVibe.addEventListener('change',  ()=> state.vibeOn  = optVibe.checked);

  // Auto-inicio al cargar (sin tocar nada)
  window.addEventListener('load', ()=> {
    // pequeÃ±o delay para asegurar layout
    setTimeout(startLevel, 300);
  });
})();
</script>
</body>
</html>
